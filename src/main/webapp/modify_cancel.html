<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Modify/Cancel Registration</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .loading-spinner {
            display: none;
        }
    </style>
</head>

<script>
    function loadHTML(url, elementId) {
        fetch(url)
            .then((response) => response.text())
            .then((data) => {
                document.getElementById(elementId).innerHTML = data;
            });
    }

    loadHTML("header.html", "header-placeholder");
    loadHTML("footer.html", "footer-placeholder");
</script>

<body>
    <div id="header-placeholder"></div>
    <div class="container">
        <div class="box">
            <h1 class="display-4 title">Modify/Cancel Registration</h1>
            <hr class="my-4" />
        </div>
        <div class="mt-4">
            <form id="generateTokenForm" method="post" action="CancelBookingServlet">
                <label for="token">Enter Token Number:</label>
                <input type="text" id="token" name="token" required class="form-control">
                <div id="responseMessage" class="mt-3"></div>
                <div class="mt-4">
                    <button type="button" id="modifyButton"
                        class="btn btn-primary btn-lg button-spacing">Modify</button>
                    <button type="submit" class="btn btn-danger btn-lg button-spacing">Cancel Booking</button>
                    <div class="loading-spinner mt-2">
                        <div class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            loadHTML("header.html", "header-placeholder");
            loadHTML("footer.html", "footer-placeholder");

            $('#generateTokenForm').on('submit', function (event) {
                event.preventDefault(); // Prevent the default form submission

                var $form = $(this);
                var formData = $form.serialize(); // Serialize form data

                // Show loading spinner and disable buttons
                $('.loading-spinner').show();
                $('#generateTokenForm button').prop('disabled', true);

                $.ajax({
                    type: 'POST',
                    url: $form.attr('action'),
                    data: formData,
                    dataType: 'json',
                    success: function (response) {
                        var messageClass = response.status === 'success' ? 'alert-success' : 'alert-danger';
                        var message = response.message;

                        $('#responseMessage').html(`<div class="alert ${messageClass}" role="alert">${message}</div>`);
                    },
                    error: function (xhr, status, error) {
                        $('#responseMessage').html('<div class="alert alert-danger" role="alert">An unexpected error occurred. Please try again later.</div>');
                    },
                    complete: function () {
                        // Hide loading spinner and enable buttons
                        $('.loading-spinner').hide();
                        $('#generateTokenForm button').prop('disabled', false);
                    }
                });
            });
        });
    </script>
</body>

</html>